{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}üìÖ Meseƒçni pregled{% endblock %}

{% block content %}
<style>
  table.attendance-table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
    font-size: 14px;
  }

  .attendance-table th,
  .attendance-table td {
    border: 1px solid #ccc;
    text-align: center;
    padding: 6px;
  }

  .attendance-table th {
    background-color: #f2f2f2;
  }

  .status-–ì–æ { background-color: #d6f5d6; }
  .status-–î { background-color: #e6e6ff; }
  .status-–î—Å { background-color: #f0e6ff; }
  .status-–°–æ { background-color: #e0ffff; }
  .status-–ë–æ { background-color: #fff3cd; }
  .status-–°–ø { background-color: #d1ecf1; }
  .status-–õ–ø { background-color: #f9d6d5; }
  .status-–û–ø–ø { background-color: #ffe0e0; }
  .status-–ù { background-color: #fce5cd; }
  .status-–°–¥ { background-color: #fff; }
  .status-–û–æ { background-color: #fef9e7; }
  .status-–ù–æ { background-color: #e8f5e9; }
  .status-–û–ø { background-color: #fbe9e7; }
  .status-–†–æ–∫ { background-color: #d0f0c0; }
  .status-–ü–£ { background-color: #e0f7fa; }
  .status-–£–æ–î { background-color: #fffde7; }
  .status-–£–ø–ø { background-color: #fff3e0; }

  select, button {
    padding: 5px;
    margin: 5px 0;
  }

  .statistika-zaposlenog {
    margin-top: 10px;
    padding: 10px;
    border-left: 3px solid #007bff;
    background-color: #f9f9f9;
  }

  .statistika-zaposlenog h5 {
    margin: 0 0 5px;
  }

  h2, h4 {
    color: #1a73e8;
  }
</style>

<h2>üìÖ Meseƒçni pregled prisustva za {{ godina }}</h2>

<form method="get" class="mb-4">
  <div class="form-group">
    <p>
      <label for="{{ forma.mesec.id_for_label }}">Mesec:</label>
      {{ forma.mesec }}
    </p>
    <p>
      <label for="{{ forma.godina.id_for_label }}">Godina:</label>
      {{ forma.godina }}
    </p>
    <p>
      <label for="{{ forma.uprava.id_for_label }}">Uprava:</label>
      {{ forma.uprava }}
    </p>
    <p>
      <label for="{{ forma.zaposleni.id_for_label }}">Zaposleni:</label>
      {{ forma.zaposleni }}
    </p>
    <button type="submit" class="btn btn-primary">üîç Prika≈æi</button>
  </div>
</form>

<div class="table-responsive">
  <table class="attendance-table">
    <thead>
      <tr>
        <th>Zaposleni</th>
        {% for dan in dani %}
          <th>{{ dan }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for z, dani_statusi in tabela.items %}
        <tr>
          <td><strong>{{ z.ime_prezime }}</strong></td>
          {% for dan in dani %}
            {% with dani_statusi|get_item:dan as status %}
              <td class="status-{{ status|slugify_status }}">{{ status }}</td>
            {% endwith %}
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if statistika_uprave.brojevi %}
  <h4>üìä Statistika uprave: {{ naziv_uprave }}</h4>
  <ul>
    {% for status, broj in statistika_uprave.brojevi.items %}
      <li><strong>{{ status }}</strong>: {{ broj }} ({{ statistika_uprave.procenti|get_item:status }})</li>
    {% endfor %}
  </ul>
{% endif %}

<h4>üë§ Statistika po zaposlenima</h4>
<select onchange="prikaziStatistiku(this.value)" class="form-control w-25 mb-3">
  <option value="">Izaberi zaposlenog</option>
  {% for z in tabela.keys %}
    <option value="zaposleni-{{ z.id }}">{{ z.ime_prezime }}</option>
  {% endfor %}
</select>

{% for z in tabela.keys %}
  <div id="zaposleni-{{ z.id }}" class="statistika-zaposlenog" style="display:none;">
    <h5>{{ z.ime_prezime }}</h5>
    {% with statistike_po_zaposlenima|get_item:z.id as stat %}
      <ul>
        {% for status, broj in stat.brojevi.items %}
          <li><strong>{{ status }}</strong>: {{ broj }} ({{ stat.procenti|get_item:status }})</li>
        {% endfor %}
      </ul>
    {% endwith %}
  </div>
{% endfor %}

<script>
function prikaziStatistiku(id) {
  document.querySelectorAll('.statistika-zaposlenog').forEach(e => e.style.display = 'none');
  if (id) {
    document.getElementById(id).style.display = 'block';
  }
}
</script>
{% endblock %}
